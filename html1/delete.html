<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test DELETE - Webserv</title>
    <link rel="stylesheet" href="/css/style.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>üóëÔ∏è Test M√©thode DELETE</h1>
            <p>Tester la suppression de ressources</p>
        </header>

        <nav>
            <ul>
                <li><a href="/index.html">Accueil</a></li>
                <li><a href="/get.html">GET</a></li>
                <li><a href="/post.html">POST</a></li>
                <li><a href="/delete.html" class="active">DELETE</a></li>
                <li><a href="/upload.html">Upload</a></li>
                <li><a href="/errors.html">Erreurs</a></li>
                <li><a href="/cgi.html">CGI</a></li>
                <li><a href="/uploads/">Autoindex</a></li>
            </ul>
        </nav>

        <div class="grid">
            <div class="card">
                <h2><span class="method-badge method-delete">DELETE</span> Supprimer un fichier</h2>
                
                <div class="alert alert-warning">
                    ‚ö†Ô∏è La m√©thode DELETE supprime d√©finitivement les fichiers du serveur.
                    Utilisez avec pr√©caution !
                </div>

                <div class="form-group">
                    <label for="delete-filename">Nom du fichier √† supprimer :</label>
                    <input type="text" id="delete-filename" placeholder="exemple.txt">
                </div>
                
                <button class="btn btn-danger" onclick="testDelete()">
                    üóëÔ∏è Supprimer
                </button>
                <button class="btn btn-primary" onclick="refreshFileList()">
                    üîÑ Lister les fichiers
                </button>

                <h3>Workflow de test :</h3>
                <ol>
                    <li>Allez sur la page <a href="/upload.html">Upload</a> pour cr√©er un fichier</li>
                    <li>Revenez ici et entrez le nom du fichier</li>
                    <li>Cliquez sur "Supprimer"</li>
                    <li>V√©rifiez que le fichier a √©t√© supprim√©</li>
                </ol>
            </div>

            <div class="card">
                <h2>üìÅ Fichiers disponibles</h2>
                <p>Fichiers dans <code>/uploads/</code> :</p>
                <ul id="delete-file-list" class="file-list">
                    <li>Cliquez sur "Lister les fichiers" pour voir la liste</li>
                </ul>
                <button class="btn btn-primary" onclick="loadDeleteFileList()">
                    üîÑ Actualiser
                </button>
            </div>
        </div>

        <div class="card">
            <h2>üì§ R√©ponse du serveur</h2>
            <div id="delete-response" class="response-box">
                <span class="status">En attente d'une requ√™te...</span>
            </div>
        </div>

        <div class="card">
            <h2>üìö Documentation DELETE</h2>
            <h3>Format de la requ√™te :</h3>
            <pre>
DELETE /uploads/fichier.txt HTTP/1.1
Host: localhost
            </pre>

            <h3>Codes de r√©ponse :</h3>
            <table>
                <tr>
                    <th>Code</th>
                    <th>Signification</th>
                    <th>Description</th>
                </tr>
                <tr>
                    <td><span class="badge badge-success">200</span></td>
                    <td>OK</td>
                    <td>Fichier supprim√© avec succ√®s + corps de r√©ponse</td>
                </tr>
                <tr>
                    <td><span class="badge badge-success">204</span></td>
                    <td>No Content</td>
                    <td>Fichier supprim√© avec succ√®s (sans corps)</td>
                </tr>
                <tr>
                    <td><span class="badge badge-danger">403</span></td>
                    <td>Forbidden</td>
                    <td>Suppression non autoris√©e</td>
                </tr>
                <tr>
                    <td><span class="badge badge-danger">404</span></td>
                    <td>Not Found</td>
                    <td>Fichier non trouv√©</td>
                </tr>
                <tr>
                    <td><span class="badge badge-danger">405</span></td>
                    <td>Method Not Allowed</td>
                    <td>DELETE non autoris√© sur cette ressource</td>
                </tr>
            </table>

            <h3>Configuration serveur :</h3>
            <pre>
location /uploads/ {
    root /var/www/uploads;
    allow_methods GET POST DELETE;
    autoindex on;
}
            </pre>
        </div>

        <footer>
            <p>Webserv Test Suite - 42 Project</p>
        </footer>
    </div>

    <script src="/js/app.js"></script>
    <script>
        async function loadDeleteFileList() {
            const list = document.getElementById('delete-file-list');
            const response = await API.get('/uploads/');
            
            if (response.ok && response.body) {
                const parser = new DOMParser();
                const doc = parser.parseFromString(response.body, 'text/html');
                const links = doc.querySelectorAll('a');
                
                let html = '';
                links.forEach(link => {
                    const filename = link.textContent;
                    if (filename && filename !== '../' && filename !== './' && !filename.endsWith('/')) {
                        html += `
                            <li>
                                <span class="file-name">
                                    <span class="file-icon">üìÑ</span>
                                    ${filename}
                                </span>
                                <button class="btn btn-danger" onclick="deleteAndRefresh('${filename}')">
                                    üóëÔ∏è
                                </button>
                            </li>
                        `;
                    }
                });
                
                list.innerHTML = html || '<li>Aucun fichier trouv√©</li>';
            } else {
                list.innerHTML = '<li>Erreur lors du chargement</li>';
            }
        }

        async function deleteAndRefresh(filename) {
            if (!confirm(`Supprimer ${filename} ?`)) return;
            
            document.getElementById('delete-filename').value = filename;
            const response = await API.delete('/uploads/' + filename);
            displayResponse('delete-response', response);
            loadDeleteFileList();
        }

        // Charger la liste au d√©marrage
        document.addEventListener('DOMContentLoaded', loadDeleteFileList);
    </script>
</body>
</html>
